<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Elevation data and OSM: The osmdata_sc function • osmdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Elevation data and OSM: The osmdata_sc function">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/osmdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>2. Elevation data and OSM: The osmdata_sc function</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2019-05-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmdata/blob/master/vignettes/osmdata-sc.Rmd"><code>vignettes/osmdata-sc.Rmd</code></a></small>
      <div class="hidden name"><code>osmdata-sc.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h2>
<p><a href="https://github.com/hypertidy/silicate"><code>silicate</code></a> is a new, largely experimental form for representing spatial data in <strong>R</strong>. In contrast to all other forms (such as <a href="https://cran.r-project.org/package=sp"><code>sp</code></a> or <a href="https://cran.r-project.org/package=sf"><code>sf</code></a>), <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a> is <em>multi-tabular</em>, and primarily consists of one table for point entities; one table for binary relationships between these point entities – spatial ‘’edges’’ – and additional tables for higher-order inter-relationships between these objects. The new <code>osmdata</code> function <code><a href="../reference/osmdata_sc.html">osmdata_sc()</a></code> returns Open Street Map (OSM) data in <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a> form. This form also closely resembles the data storage scheme of Open Street Map itself, and in this case consists of the following tables:</p>
<ol style="list-style-type: decimal">
<li>A <code>vertex</code> table holding the coordinates of all OSM nodes;</li>
<li>An <code>edge</code> table mapping all edge connections between vertices;</li>
<li>An <code>object_link_edge</code> table linking all <code>edge</code> entities to the OSM objects of which they are part;</li>
<li>An <code>object</code> table holding all ‘key’–‘value’ pairs for each OSM <em>way</em> object;</li>
<li>A <code>relation_properties</code> table holding all ‘key’–‘value’ pairs for each OSM <em>relation</em> object;</li>
<li>A <code>relation_members</code> table holding all members of each OSM relation; and</li>
<li>A <code>nodes</code> table holding all ‘key’–‘value’ pairs for each OSM <em>node</em> object.</li>
</ol>
<p>The translation of the underlying OSM data structure – consisting of nodes, way, and relations – into <a href="http://www.opengeospatial.org/standards/sfa">Simple Features (SF)</a> via the <a href="https://ropensci.github.io/osmdata/reference/osmdata_sf.html"><code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code></a> function is less than 100% faithful, and results in some representational loss compared with the original OSM structure (for details, see the <a href="https://ropensci.github.io/osmdata/articles/osm-sf-translation.html">vignette on translation of OSM into SF</a>). In contrast, the <a href="https://ropensci.github.io/osmdata/reference/osmdata_sc.html"><code><a href="../reference/osmdata_sc.html">osmdata_sc()</a></code> function</a> delivers a representation that is entirely faithful to the underlying OSM representation.</p>
<p>The <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a> format itself is currently highly experimental, and is therefore not expected to gain widespread use just yet. It nevertheless offers the single advantage in the <code>osmdata</code> package of enabling elevation data to be combined with OSM data. The result is a <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a>-format object which may currently be of limited general utility, but is nevertheless able to be submitted directly to the <a href="https://github.com/ATFutures/dodgr"><code>dodgr</code> package</a> to enable routing on street networks that accounts for elevation changes.</p>
</div>
<div id="elevation-data" class="section level2">
<h2 class="hasAnchor">
<a href="#elevation-data" class="anchor"></a>2. Elevation Data</h2>
<p>Incorporating elevation data with OSM data currently requires local storage of desired elevation data. These must be downloaded for the desired region from <a href="http://srtm.csi.cgiar.org/srtmdata">https://srtm.csi.cgiar.org/srtmdata</a> in Geo TIFF format. Elevation data may then be incorporated with <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a>-format data generated by <a href="https://ropensci.github.io/osmdata/reference/osmdata_sc.html"><code>x &lt;- osmdata_sc()</code></a> through the <code><a href="../reference/osm_elevation.html">osm_elevation()</a></code> function. The entire procedure is demonstrated with the following lines:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="st">"omaha nebraska"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span> (<span class="dt">key =</span> <span class="st">"highway"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/osmdata_sc.html">osmdata_sc</a></span> ()</a></code></pre></div>
<p>This object has a <code>vertex</code> table like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">dat<span class="op">$</span>vertex</a></code></pre></div>
<pre><code>## # A tibble: 345,239 x 3
##       x_    y_ vertex_  
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
##  1 -95.9  41.2 31536366 
##  2 -95.9  41.2 31536367 
##  3 -95.9  41.2 31536368 
##  4 -95.9  41.2 31536370 
##  5 -95.9  41.2 31536378 
##  6 -95.9  41.2 31536379 
##  7 -96.2  41.3 133898322
##  8 -96.2  41.3 133898328
##  9 -96.3  41.3 133898340
## 10 -96.3  41.3 133898342
## # … with 345,229 more rows</code></pre>
<p>Incorporating elevation data is then as simple as</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osm_elevation.html">osm_elevation</a></span> (dat, <span class="dt">elev_file =</span> <span class="st">"/path/to/elevation/data/filename.tiff"</span>)</a></code></pre></div>
<pre><code>## Loading required namespace: raster
## Elevation data from Consortium for Spatial Information; see http://srtm.csi.cgiar.org/srtmdata/</code></pre>
<p>This function then simply appends the elevation values to the <code>vertex_</code> table, so that it now looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">dat<span class="op">$</span>vertex_</a></code></pre></div>
<pre><code>## # A tibble: 345,239 x 4
##       x_    y_    z_ vertex_  
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
##  1 -95.9  41.2   291 31536366 
##  2 -95.9  41.2   295 31536367 
##  3 -95.9  41.2   297 31536368 
##  4 -95.9  41.2   301 31536370 
##  5 -95.9  41.2   295 31536378 
##  6 -95.9  41.2   300 31536379 
##  7 -96.2  41.3   359 133898322
##  8 -96.2  41.3   359 133898328
##  9 -96.3  41.3   358 133898340
## 10 -96.3  41.3   358 133898342
## # … with 345,229 more rows</code></pre>
<div id="example-usage-of-elevation-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-usage-of-elevation-data" class="anchor"></a>Example usage of elevation data</h3>
<p>The <a href="https://github.com/hypertidy/silicate"><code>silicate</code></a> format is very easy to manipulate using standard <a href="https://dplyr.tidyverse.org"><code>dplyr</code></a> verbs. The following code uses the <a href="https://github.com/SymbolixAU/mapdeck"><code>mapdeck</code> package</a> package to colour the street network and elevation data downloaded and processed in the preceding lines by the elevation of each network edge. We first join the vertex elevation data on to the edges, and calculate the mean elevation of each edge.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">edges &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">left_join</span> (dat<span class="op">$</span>edge, dat<span class="op">$</span>vertex, <span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span> (<span class="st">".vx0"</span> =<span class="st"> "vertex_"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span> (<span class="st">".vx0_x"</span> =<span class="st"> </span>x_, <span class="st">".vx0_y"</span> =<span class="st"> </span>y_, <span class="st">".vx0_z"</span> =<span class="st"> </span>z_) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">left_join</span> (dat<span class="op">$</span>vertex, <span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span> (<span class="st">".vx1"</span> =<span class="st"> "vertex_"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span> (<span class="st">".vx1_x"</span> =<span class="st"> </span>x_, <span class="st">".vx1_y"</span> =<span class="st"> </span>y_, <span class="st">".vx1_z"</span> =<span class="st"> </span>z_) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span> (<span class="st">"zmn"</span> =<span class="st"> </span>(.vx0_z <span class="op">+</span><span class="st"> </span>.vx1_z) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span> (<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span> (.vx0_z, .vx1_z))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">edges</a></code></pre></div>
<pre><code>## # A tibble: 376,370 x 8
##    .vx0       .vx1       edge_      .vx0_x .vx0_y .vx1_x .vx1_y   zmn
##    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 1903265686 1903265664 V6kgqvWjtM  -96.2   41.3  -96.2   41.3   351
##  2 1903265664 1903265638 mX4HQkykiD  -96.2   41.3  -96.2   41.3   352
##  3 1903265638 1903265710 26e5NHT8nI  -96.2   41.3  -96.2   41.3   352
##  4 1903265710 1903265636 9TOmVAvGH4  -96.2   41.3  -96.2   41.3   352
##  5 1903265636 1903265685 hYbpf832vX  -96.2   41.3  -96.2   41.3   352
##  6 1903265685 1903265678 ctvd1FWGEw  -96.2   41.3  -96.2   41.3   352
##  7 1903265678 1903265646 mvaAOdSOKA  -96.2   41.3  -96.2   41.3   352
##  8 1903265646 1903265714 dSVFPNDFty  -96.2   41.3  -96.2   41.3   352
##  9 1903265714 1903265659 uc8L3jGR87  -96.2   41.3  -96.2   41.3   352
## 10 1903265659 1903265702 MpjXnvIvcF  -96.2   41.3  -96.2   41.3   352
## # … with 376,360 more rows</code></pre>
<p>Those data can then be submitted directly to <a href="https://github.com/SymbolixAU/mapdeck"><code>mapdeck</code></a> to generate an interactive plot with the following code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span> (mapdeck)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">set_token</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span> (<span class="st">"MAPBOX_TOKEN"</span>)) <span class="co"># load local token for MapBox</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">mapdeck</span> (<span class="dt">style =</span> <span class="kw">mapdeck_style</span> (<span class="st">"dark"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">    </span><span class="kw">add_line</span> (edges,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">              <span class="dt">origin =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span> (<span class="st">".vx0_x"</span>, <span class="st">".vx0_y"</span>),</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">              <span class="dt">destination =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span> (<span class="st">".vx1_x"</span>, <span class="st">".vx1_y"</span>),</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">              <span class="dt">stroke_colour =</span> <span class="st">"z"</span>,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">              <span class="dt">legend =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>(The result is not shown here, but can be directly inspected by simply running the above lines.)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1. Introduction</a></li>
      <li><a href="#elevation-data">2. Elevation Data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Bob Rudis, Robin Lovelace, Maëlle Salmon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
